"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}var GateForm=function(){function e(t,a){var o=a.onSubmit,n=a.onIncorrect,l=a.formSelector;_classCallCheck(this,e),this.selector=t,this.el=document.querySelector(t),this.btn=this.el.querySelector(".gate-form__submit"),this.onSubmit=o||function(){},this.onIncorrect=n||function(){alert("Выбраны не все значения!")},this.form=document.querySelector(l),this.mainImg=[this.el.querySelector(".gate-form__img img").getAttribute("src"),this.el.querySelector(".gate-form__img img").getAttribute("data-src")],this.setup()}return _createClass(e,[{key:"getFormData",value:function(){var e=this.el.querySelectorAll("input"),t={},a=!0;return e.forEach((function(e){var a=e.getAttribute("name");"checkbox"!==e.getAttribute("type")&&"radio"!==e.getAttribute("type")||!e.checked?("number"===e.getAttribute("type")||"text"===e.getAttribute("type"))&&e.value.length>0&&(t[a]=e.value):t[a]=t[a]?t[a]+", "+e.value:e.value})),e.forEach((function(e){var o=e.getAttribute("name");t[o]||"checkbox"===e.getAttribute("type")||(a=!1)})),!!a&&t}},{key:"getInputs",value:function(e){var t=[];for(var a in e){var o=document.createElement("input");o.setAttribute("type","hidden"),o.setAttribute("name",a),o.setAttribute("value",e[a]),t.push(o)}return t}},{key:"changeImage",value:function(e){var t=!0;(this.mainImg.forEach((function(e){null==e&&(t=!1)})),t)&&this.el.querySelector(".gate-form__img img").setAttribute("src",this.mainImg[e])}},{key:"togglePanels",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"auto",t=this.el.querySelectorAll('input[name="gate-type"]'),a=this.el.querySelectorAll('input[name="gate-panel"]'),o=this.el.querySelectorAll('input[name="gate-panel"] + label');function n(){for(var e=1;e<a.length;e++)a[e].checked=!1,o[e].style.display="none"}function l(){o.forEach((function(e){e.style.display=""}))}switch(e){case"show":l();break;case"hide":n();break;case"auto":t[0].checked?l():n()}}},{key:"getPanelIndex",value:function(){for(var e=this.el.querySelectorAll('input[name="gate-panel"]'),t=0;t<e.length;t++)if(e[t].checked)return t}},{key:"_setupInputs",value:function(){var e=this,t=function(t,a){var o=e.el.querySelector('.output span[data-output="'+t+'"]');null!==o&&(o.innerText=a)},a=function(t,a){var o=e.el.querySelector('.output span[data-output-by-id="'+t+'"]');null!==o&&(o.innerText=a)},o=this.el.querySelectorAll("input[type=checkbox]"),n=this.el.querySelectorAll("input[type=radio]"),l=this.el.querySelectorAll("input[type=number]");o.forEach((function(o){o.addEventListener("change",(function(n){var l=o.getAttribute("id");null!==e.el.querySelector('.output span[data-output-by-id="'+l+'"]')?o.checked?a(l,"Да"):a(l,"Нет"):o.checked?t(o.getAttribute("name"),"Да"):t(o.getAttribute("name"),"Нет")}))})),n.forEach((function(a,o){a.addEventListener("change",(function(n){t(a.getAttribute("name"),a.value),e.selector.match(".garage")&&"gate-type"==a.getAttribute("name")&&(e.togglePanels(),void 0===e.getPanelIndex()&&t("gate-panel","-")),"gate-type"==a.getAttribute("name")&&e.changeImage(o)}))})),l.forEach((function(e){e.addEventListener("change",(function(a){t(e.getAttribute("name"),e.value)}))}))}},{key:"clearHiddenInputs",value:function(){this.form.querySelectorAll('input[type="hidden"][name^="gate"]').forEach((function(e){e.remove()}))}},{key:"setup",value:function(){var e=this;this.el.addEventListener("submit",(function(t){t.preventDefault();var a=e.getFormData();a?(e.clearHiddenInputs(),e.getInputs(a).forEach((function(t){e.form.appendChild(t)})),e.onSubmit()):e.onIncorrect()})),this._setupInputs()}}]),e}(),InfoTooltips=function(){function e(){_classCallCheck(this,e),this.elems=document.querySelectorAll(".info"),this.contentItems=document.querySelectorAll(".info .info__content"),this.btns=document.querySelectorAll(".info .info__btn"),this.tooltip=null,this.setup()}return _createClass(e,[{key:"getTooltipElem",value:function(e){var t=e.cloneNode(!0);return t.classList="",t.classList.add("info-tooltip"),t}},{key:"setTooltip",value:function(e,t){this.tooltip.style.left=e+"px",this.tooltip.style.top=t+"px",document.body.append(this.tooltip)}},{key:"removeTooltip",value:function(){this.tooltip.remove(),this.tooltip=null}},{key:"setup",value:function(){var e=this;this.btns.forEach((function(t,a){t.addEventListener("mouseenter",(function(t){var o=t.pageX+20,n=t.pageY+5;e.tooltip=e.getTooltipElem(e.contentItems[a]),e.setTooltip(o,n)})),t.addEventListener("mouseleave",(function(t){e.removeTooltip()}))}))}}]),e}(),activeModal=null,Modal=function(){function e(t,a){var o=a.onCall;_classCallCheck(this,e),this.selector=t,this.el=document.querySelector(this.selector),this.el&&(this.onCall=o||function(){},this.overlay=this.el.querySelector(".modal__overlay"),this.closeBtn=this.el.querySelector(".modal__close"),this.setup())}return _createClass(e,[{key:"showModal",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];activeModal=this,t?this.el.classList.add("active"):(this.el.classList.remove("hiding"),this.el.classList.add("active"),this.el.classList.add("showing"),setTimeout((function(){e.el.classList.remove("showing")}),250)),document.body.classList.add("lock"),this.onCall()}},{key:"hideModal",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];activeModal=null,t?this.el.classList.remove("active"):(this.el.classList.remove("showing"),this.el.classList.add("hiding"),setTimeout((function(){e.el.classList.remove("active"),e.el.classList.remove("hiding")}),250)),document.body.classList.remove("lock")}},{key:"showingHandler",value:function(){this.el.classList.contains("active")?this.hideModal():this.showModal()}},{key:"setup",value:function(){var e=this;this.closeBtn.addEventListener("click",(function(t){e.hideModal()})),this.overlay.addEventListener("mousedown",(function(t){t.target===e.overlay&&e.hideModal()}))}}]),e}();function sendForm(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t=t||function(){},event.preventDefault(),validateForm(e)){var a=new XMLHttpRequest,o=serialize(e);a.open("POST","./mail.php"),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){if(4==a.readyState&&200==a.status&&(e.reset(),t(),e.setAttribute("data-done",null),e.hasAttribute("data-after"))){activeModal&&activeModal.hideModal();var o=e.getAttribute("data-after");afterModals[o].showModal()}},a.send(o)}else incorrectFormData.showModal()}function validateForm(e){var t=e.querySelector('input[name="tel"]'),a=e.querySelector('input[name="name"]'),o=!0;return t&&!t.value.match(/^((8|\+7)[\- ]?)?(\(?\d{3}\)?[\- ]?)?[\d\- ]{7,10}$/)&&(o=!1),a&&a.value.length<2&&(o=!1),o}function serialize(e){if(!e||"FORM"!==e.nodeName)return!1;var t,a,o=[];for(t=e.elements.length-1;t>=0;t-=1)if(""!==e.elements[t].name)switch(e.elements[t].nodeName){case"INPUT":switch(e.elements[t].type){case"text":case"tel":case"email":case"hidden":case"password":case"button":case"reset":case"submit":o.push(e.elements[t].name+"="+encodeURIComponent(e.elements[t].value));break;case"checkbox":writeCommaCheckbox(e,t,o);break;case"radio":e.elements[t].checked&&o.push(e.elements[t].name+"="+encodeURIComponent(e.elements[t].value))}break;case"file":break;case"TEXTAREA":o.push(e.elements[t].name+"="+encodeURIComponent(e.elements[t].value));break;case"SELECT":switch(e.elements[t].type){case"select-one":o.push(e.elements[t].name+"="+encodeURIComponent(e.elements[t].value));break;case"select-multiple":for(a=e.elements[t].options.length-1;a>=0;a-=1)e.elements[t].options[a].selected&&o.push(e.elements[t].name+"="+encodeURIComponent(e.elements[t].options[a].value))}break;case"BUTTON":switch(e.elements[t].type){case"reset":case"submit":case"button":o.push(e.elements[t].name+"="+encodeURIComponent(e.elements[t].value))}}return o.join("&")}var tooltips=new InfoTooltips,ownModal=new Modal("#ownForm",{onCall:function(){var e=ownModal.el.querySelector("form");if(e&&e.hasAttribute("data-done")){ownModal.hideModal(!0);var t=e.getAttribute("data-after");afterModals[t].showModal()}}}),garageGateModal=new Modal("#garageGateForm",{onCall:function(){var e=garageGateModal.el.querySelector("form");if(e&&e.hasAttribute("data-done")){garageGateModal.hideModal(!0);var t=e.getAttribute("data-after");afterModals[t].showModal()}}}),swingGateModal=new Modal("#swingGateForm",{onCall:function(){var e=swingGateModal.el.querySelector("form");if(e&&e.hasAttribute("data-done")){swingGateModal.hideModal(!0);var t=e.getAttribute("data-after");afterModals[t].showModal()}}}),slidingGateModal=new Modal("#slidingGateForm",{onCall:function(){var e=slidingGateModal.el.querySelector("form");if(e&&e.hasAttribute("data-done")){slidingGateModal.hideModal(!0);var t=e.getAttribute("data-after");afterModals[t].showModal()}}}),callModal=new Modal("#callMe",{onCall:function(){var e=callModal.el.querySelector("form");if(e&&e.hasAttribute("data-done")){callModal.hideModal(!0);var t=e.getAttribute("data-after");afterModals[t].showModal()}}}),thanksCalc=new Modal("#thanksCalc",{}),thanksCall=new Modal("#thanksCall",{}),incorrectFields=new Modal("#incorrectFields",{}),incorrectFormData=new Modal("#incorrectFormData",{}),afterModals={thanksCalc:thanksCalc,thanksCall:thanksCall},ownGateForm=new GateForm(".own .gate-form",{formSelector:"#ownForm form",onSubmit:function(){ownModal.showModal()},onIncorrect:function(){incorrectFields.showModal()}}),garageGateForm=new GateForm(".garage .gate-form",{formSelector:"#garageGateForm form",onSubmit:function(){garageGateModal.showModal()},onIncorrect:function(){incorrectFields.showModal()}}),slidingGateForm=new GateForm(".sliding .gate-form",{formSelector:"#slidingGateForm form",onSubmit:function(){slidingGateModal.showModal()},onIncorrect:function(){incorrectFields.showModal()}}),swingGateForm=new GateForm(".swing .gate-form",{formSelector:"#swingGateForm form",onSubmit:function(){swingGateModal.showModal()},onIncorrect:function(){incorrectFields.showModal()}}),showModalCallBtn=document.querySelector("#showModalCall");showModalCallBtn.addEventListener("click",(function(){callModal.showModal()}));
//# sourceMappingURL=maps/main.min.js.map
